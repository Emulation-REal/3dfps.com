<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>3D FPS with ESP and Tracers</title>
<style>
  body { margin: 0; overflow: hidden; background: #222; }
  canvas { display: block; }
</style>
</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script>
let scene, camera, renderer;
let remotePlayers = {};
let espBoxes = [];
let tracerLines = [];

let mods = {
  esp: true,
  tracers: true,
};

init();
animate();

function init() {
  scene = new THREE.Scene();

  camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
  camera.position.set(0, 2, 5);

  renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  // Example: Add some remote players (boxes)
  addDummyPlayers();

  // Lighting
  const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
  scene.add(ambientLight);

  const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
  dirLight.position.set(5, 10, 7);
  scene.add(dirLight);

  window.addEventListener('resize', onWindowResize);
}

function addDummyPlayers() {
  // Create 5 dummy players at different positions
  for (let i = 0; i < 5; i++) {
    const geometry = new THREE.BoxGeometry(1, 2, 1);
    const material = new THREE.MeshStandardMaterial({color: 0x0077ff});
    const mesh = new THREE.Mesh(geometry, material);
    mesh.position.set((i - 2) * 3, 1, -5 - i * 2);
    scene.add(mesh);
    remotePlayers[`player${i}`] = { mesh };
  }
}

function updateESPandTracers() {
  // Clear old ESP boxes and tracer lines
  espBoxes.forEach(b => scene.remove(b));
  espBoxes.length = 0;

  tracerLines.forEach(l => scene.remove(l));
  tracerLines.length = 0;

  for (const id in remotePlayers) {
    const player = remotePlayers[id];

    if (mods.esp) {
      // Compute bounding box of player mesh
      const box3 = new THREE.Box3().setFromObject(player.mesh);

      // Create Box3Helper for bounding box
      const boxHelper = new THREE.Box3Helper(box3, 0x00ff00);

      // Make the box helper material ignore depth so it's visible through walls
      boxHelper.material.depthTest = false;
      boxHelper.material.transparent = true;
      boxHelper.material.opacity = 0.4;

      espBoxes.push(boxHelper);
      scene.add(boxHelper);
    }

    if (mods.tracers) {
      // Draw a red line from camera center to the player (roughly chest height)
      const start = camera.position.clone();
      const end = player.mesh.position.clone();
      end.y += 1;

      const points = [start, end];
      const geometry = new THREE.BufferGeometry().setFromPoints(points);

      const material = new THREE.LineBasicMaterial({
        color: 0xff0000,
        depthTest: false,   // so it draws through walls
        transparent: true,
        opacity: 0.7,
        linewidth: 2, // Note: linewidth may not work in all browsers
      });

      const line = new THREE.Line(geometry, material);
      tracerLines.push(line);
      scene.add(line);
    }
  }
}

function animate() {
  requestAnimationFrame(animate);

  updateESPandTracers();

  renderer.render(scene, camera);
}

function onWindowResize() {
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
}

</script>
</body>
</html>
